name: Daily GitHub Trending Repos

on:
  schedule:
    - cron: '0 6 * * *'
  workflow_dispatch:

jobs:
  fetch-trending:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Fetch Python repos
        run: |
          curl -s -H "Authorization: token ${{ github.token }}" \
            "https://api.github.com/search/repositories?q=language:python+stars:>50+created:>$(date -d '30 days ago' +%Y-%m-%d)&sort=stars&order=desc&per_page=15" \
            > python_repos.json

      - name: Fetch JavaScript repos
        run: |
          curl -s -H "Authorization: token ${{ github.token }}" \
            "https://api.github.com/search/repositories?q=language:javascript+stars:>50+created:>$(date -d '30 days ago' +%Y-%m-%d)&sort=stars&order=desc&per_page=15" \
            > js_repos.json

      - name: Fetch TypeScript repos
        run: |
          curl -s -H "Authorization: token ${{ github.token }}" \
            "https://api.github.com/search/repositories?q=language:typescript+stars:>50+created:>$(date -d '30 days ago' +%Y-%m-%d)&sort=stars&order=desc&per_page=15" \
            > ts_repos.json

      - name: Fetch Rust repos
        run: |
          curl -s -H "Authorization: token ${{ github.token }}" \
            "https://api.github.com/search/repositories?q=language:rust+stars:>50+created:>$(date -d '30 days ago' +%Y-%m-%d)&sort=stars&order=desc&per_page=15" \
            > rust_repos.json

      - name: Fetch Go repos
        run: |
          curl -s -H "Authorization: token ${{ github.token }}" \
            "https://api.github.com/search/repositories?q=language:go+stars:>50+created:>$(date -d '30 days ago' +%Y-%m-%d)&sort=stars&order=desc&per_page=15" \
            > go_repos.json

      - name: Create report
        run: |
          TODAY=$(date +%Y-%m-%d)

          {
            echo "# ðŸ“Š Daily GitHub Repos Report - $TODAY"
            echo ""
            echo "> Filter: stars > 50, created < 30 days"
            echo ""
            echo "---"
            echo ""
            echo "## ðŸ Python Repos"
            echo ""
            echo "| â­ Stars | ðŸ´ Forks | Repo | License |"
            echo "|----------|----------|------|---------|"
            jq -r '.items[] | "| \(.stargazers_count) | \(.forks_count) | [\(.full_name)](\(.html_url)) | \(if .license then .license.spdx_id else "N/A" end) |"' python_repos.json

            echo ""
            echo "---"
            echo ""
            echo "## ðŸŒ JavaScript Repos"
            echo ""
            echo "| â­ Stars | ðŸ´ Forks | Repo | License |"
            echo "|----------|----------|------|---------|"
            jq -r '.items[] | "| \(.stargazers_count) | \(.forks_count) | [\(.full_name)](\(.html_url)) | \(if .license then .license.spdx_id else "N/A" end) |"' js_repos.json

            echo ""
            echo "---"
            echo ""
            echo "## ðŸ’Ž TypeScript Repos"
            echo ""
            echo "| â­ Stars | ðŸ´ Forks | Repo | License |"
            echo "|----------|----------|------|---------|"
            jq -r '.items[] | "| \(.stargazers_count) | \(.forks_count) | [\(.full_name)](\(.html_url)) | \(if .license then .license.spdx_id else "N/A" end) |"' ts_repos.json

            echo ""
            echo "---"
            echo ""
            echo "## âš™ï¸ Rust Repos"
            echo ""
            echo "| â­ Stars | ðŸ´ Forks | Repo | License |"
            echo "|----------|----------|------|---------|"
            jq -r '.items[] | "| \(.stargazers_count) | \(.forks_count) | [\(.full_name)](\(.html_url)) | \(if .license then .license.spdx_id else "N/A" end) |"' rust_repos.json

            echo ""
            echo "---"
            echo ""
            echo "## ðŸ¹ Go Repos"
            echo ""
            echo "| â­ Stars | ðŸ´ Forks | Repo | License |"
            echo "|----------|----------|------|---------|"
            jq -r '.items[] | "| \(.stargazers_count) | \(.forks_count) | [\(.full_name)](\(.html_url)) | \(if .license then .license.spdx_id else "N/A" end) |"' go_repos.json

            echo ""
            echo "---"
            echo ""
            echo "## ðŸ’¡ License Guide"
            echo ""
            echo "| License | ThÆ°Æ¡ng máº¡i | Custom/BÃ¡n |"
            echo "|---------|------------|------------|"
            echo "| MIT | âœ… | âœ… |"
            echo "| Apache 2.0 | âœ… | âœ… |"
            echo "| BSD-3-Clause | âœ… | âœ… |"
            echo "| GPLv3 | âš ï¸ | âŒ |"
            echo "| No License | âŒ | âŒ |"
            echo ""
            echo "*Generated: $TODAY*"

          } > daily-repos-report.md

          echo "Report created!"
          cat daily-repos-report.md

      - name: Commit and push
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add -A
          git commit -m "Update report - $(date +%Y-%m-%d)" || echo "No changes"
          git push
